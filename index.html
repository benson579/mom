<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>佳士多旅遊總監 - 阿虹名片</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');
        /* 背景色改為清爽的灰白色，字體顏色深藍 */
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f0f2f5; color: #2c3e50; }
        /* 品牌色：海軍藍漸層 */
        .brand-bg { background: linear-gradient(135deg, #2c3e50 0%, #3498DB 100%); }
    </style>
    <!-- 全域錯誤攔截器 (Benson 架構核心：發生錯誤時會顯示在畫面上，方便除錯) -->
    <script>
        window.onerror = function(message, source, lineno, colno, error) {
            const errorDiv = document.getElementById('debugInfo');
            if (errorDiv) {
                errorDiv.style.display = 'block';
                errorDiv.innerText = "系統錯誤: " + message + "\n行數: " + lineno;
            }
            const ui = document.getElementById('errorUI');
            const det = document.getElementById('errorDetail');
            if(ui && det) {
                ui.classList.remove('hidden');
                document.getElementById('statusUI').classList.add('hidden');
                det.innerText = "程式執行錯誤: " + message;
            }
        };
    </script>
</head>
<body class="min-h-screen flex items-center justify-center p-6 text-center">

    <div class="max-w-xs w-full">
        <!-- 1. 狀態顯示 (Loading) -->
        <div id="statusUI">
            <div class="w-12 h-12 border-4 border-[#3498DB] border-t-transparent rounded-full animate-spin mx-auto mb-6"></div>
            <h1 class="text-xl font-bold mb-2 tracking-wide">名片準備中</h1>
            <p id="statusDesc" class="text-gray-500 text-sm">正在喚醒阿虹的名片...</p>
        </div>

        <!-- 2. 手動發送按鈕 (Benson 架構核心：當自動發送被取消或失敗時顯示) -->
        <div id="manualUI" class="hidden">
            <div class="w-16 h-16 brand-bg rounded-2xl mx-auto mb-6 flex items-center justify-center shadow-2xl text-white">
                <i class="fas fa-paper-plane text-2xl"></i>
            </div>
            <h1 class="text-xl font-bold mb-2">名片已就緒</h1>
            <p class="text-gray-500 text-xs mb-8">點擊下方按鈕，選擇好友分享名片</p>
            <button onclick="sendAhongCard()" class="w-full py-4 brand-bg text-white rounded-2xl font-black text-lg active:scale-95 transition-all shadow-lg hover:shadow-blue-900/20">
                發送名片
            </button>
        </div>

        <!-- 3. 錯誤 UI (Benson 架構核心：顯示錯誤訊息) -->
        <div id="errorUI" class="hidden">
            <div class="bg-red-500/10 border border-red-500/50 p-6 rounded-3xl text-left">
                <h1 class="text-red-500 font-bold mb-2 text-center">發生錯誤</h1>
                <p id="errorDetail" class="text-gray-600 text-xs break-all font-mono mb-4"></p>
                <div id="envInfo" class="text-[10px] text-gray-400 border-t border-gray-300 pt-2 font-mono"></div>
                <button onclick="window.location.reload()" class="w-full mt-4 py-2 bg-gray-200 rounded text-xs uppercase hover:bg-gray-300 font-bold text-gray-600">重新載入</button>
            </div>
        </div>
        
        <!-- 除錯資訊懸浮窗 -->
        <div id="debugInfo" style="display:none; position:fixed; bottom:0; left:0; width:100%; background:rgba(0,0,0,0.9); color:red; font-size:10px; padding:10px; text-align:left; z-index:9999;"></div>
    </div>

    <script>
        const MY_LIFF_ID = "2008788337-c00C9UGS"; 
        
        // 分享連結 (回流到這個發射器)
        const shareUrl = "https://liff.line.me/" + MY_LIFF_ID;

        // 阿虹名片的 JSON 資料
        const ahongJson = {
          "type": "bubble",
          "hero": {
            "type": "image",
            "url": "https://i.postimg.cc/2StGJdPr/8DBF6C7B-90B7-491F-8CFB-B5156FD87732.jpg",
            "size": "full",
            "aspectRatio": "20:13",
            "aspectMode": "cover",
            "action": {
              "type": "uri",
              "uri": "https://line.me/ti/p/FaXuuoOYal"
            }
          },
          "body": {
            "type": "box",
            "layout": "vertical",
            "contents": [
              {
                "type": "text",
                "text": "佳士多旅遊總監",
                "weight": "bold",
                "size": "xl",
                "color": "#ffffff",
                "position": "absolute",
                "offsetBottom": "15px",
                "offsetLeft": "15px",
                "wrap": true,
                "style": "normal",
                "shadow": true
              },
              {
                "type": "text",
                "text": "帶您看見世界的美",
                "size": "xs",
                "color": "#ffffffcc",
                "position": "absolute",
                "offsetBottom": "40px",
                "offsetLeft": "15px"
              },
              {
                "type": "box",
                "layout": "baseline",
                "contents": [
                  {
                    "type": "text",
                    "text": "全方位旅遊 x 生活選物",
                    "weight": "bold",
                    "size": "md",
                    "color": "#2c3e50",
                    "flex": 1
                  },
                  {
                    "type": "box", "layout": "vertical", "flex": 0, "backgroundColor": "#FFF0E0", "cornerRadius": "sm", "paddingAll": "xs",
                    "contents": [
                        { "type": "text", "text": "20年資歷", "size": "xxs", "color": "#E67E22", "weight": "bold" }
                    ]
                  }
                ],
                "margin": "md"
              },
              {
                "type": "text",
                "text": "整合三大旅行社資源，為您打造最完美的旅程。懂玩、懂吃、懂生活。",
                "size": "xs",
                "color": "#555555",
                "wrap": true,
                "margin": "md"
              },
              {
                "type": "separator",
                "margin": "lg"
              },
              {
                "type": "box",
                "layout": "vertical",
                "margin": "lg",
                "spacing": "md",
                "contents": [
                  {
                    "type": "box",
                    "layout": "horizontal",
                    "spacing": "md",
                    "contents": [
                      {
                        "type": "icon",
                        "url": "https://cdn-icons-png.flaticon.com/512/723/723955.png",
                        "size": "sm",
                        "offsetTop": "xs"
                      },
                      {
                        "type": "box",
                        "layout": "vertical",
                        "contents": [
                          { "type": "text", "text": "專業職人", "size": "xxs", "color": "#aaaaaa", "weight": "bold" },
                          { "type": "text", "text": "佳士多旅行社 業務總監", "size": "sm", "color": "#2c3e50", "weight": "bold", "wrap": true },
                          { "type": "text", "text": "山富旅行社 資深領隊導遊", "size": "xs", "color": "#666666", "wrap": true }
                        ]
                      }
                    ]
                  },
                  {
                    "type": "box",
                    "layout": "horizontal",
                    "spacing": "md",
                    "contents": [
                      {
                        "type": "icon",
                        "url": "https://cdn-icons-png.flaticon.com/512/1256/1256650.png",
                        "size": "sm", "offsetTop": "xs"
                      },
                      {
                        "type": "box",
                        "layout": "vertical",
                        "contents": [
                          { "type": "text", "text": "在地深耕", "size": "xxs", "color": "#aaaaaa", "weight": "bold" },
                          { "type": "text", "text": "愛旅遊 中部合作夥伴", "size": "sm", "color": "#2c3e50", "weight": "bold", "wrap": true },
                          { "type": "text", "text": "客製化行程規劃專家", "size": "xs", "color": "#666666", "wrap": true }
                        ]
                      }
                    ]
                  },
                  {
                    "type": "box",
                    "layout": "horizontal",
                    "spacing": "md",
                    "contents": [
                      {
                        "type": "icon",
                        "url": "https://cdn-icons-png.flaticon.com/512/2921/2921226.png",
                        "size": "sm", "offsetTop": "xs"
                      },
                      {
                        "type": "box",
                        "layout": "vertical",
                        "contents": [
                          { "type": "text", "text": "生活風格", "size": "xxs", "color": "#aaaaaa", "weight": "bold" },
                          { "type": "text", "text": "百萬團購主 (FB社團)", "size": "sm", "color": "#E74C3C", "weight": "bold", "wrap": true },
                          { "type": "text", "text": "分享旅行與生活中的美好事物", "size": "xs", "color": "#666666", "wrap": true }
                        ]
                      }
                    ]
                  }
                ]
              }
            ]
          },
          "footer": {
            "type": "box",
            "layout": "vertical",
            "spacing": "sm",
            "contents": [
              {
                "type": "box",
                "layout": "horizontal",
                "spacing": "sm",
                "contents": [
                  {
                    "type": "button",
                    "style": "primary",
                    "height": "sm",
                    "action": {
                      "type": "uri",
                      "label": "諮詢行程",
                      "uri": "https://line.me/ti/p/FaXuuoOYal"
                    },
                    "color": "#06C755",
                    "flex": 1
                  },
                  {
                    "type": "button",
                    "style": "primary",
                    "height": "sm",
                    "action": {
                      "type": "uri",
                      "label": "逛逛團購",
                      "uri": "https://www.facebook.com/share/17GC8EFYAD/?mibextid=wwXIfr"
                    },
                    "color": "#1877F2",
                    "flex": 1
                  }
                ]
              },
              {
                "type": "button",
                "style": "secondary",
                "height": "sm",
                "action": {
                  "type": "uri",
                  "label": "分享名片給好友",
                  "uri": shareUrl
                },
                "color": "#F1F3F4"
              }
            ]
          }
        };

        // UI 切換控制 (Benson 架構)
        function showUI(id, msg = "") {
            document.getElementById('statusUI').classList.add('hidden');
            document.getElementById('manualUI').classList.add('hidden');
            document.getElementById('errorUI').classList.add('hidden');
            
            if(id === 'errorUI') {
                document.getElementById('errorDetail').innerText = msg;
                let env = "Env: ";
                try { env += liff.getOS() + " / " + liff.getLanguage() + " / " + liff.getVersion(); } catch(e){}
                document.getElementById('envInfo').innerText = env;
            }
            
            document.getElementById(id).classList.remove('hidden');
        }

        // 發送名片邏輯
        async function sendAhongCard() {
            try {
                const res = await liff.shareTargetPicker([
                    {
                        "type": "flex",
                        "altText": "這是阿虹的旅遊名片，推薦給您！",
                        "contents": ahongJson
                    }
                ]);
                
                if (res) { 
                    liff.closeWindow(); 
                } else { 
                    // 如果取消分享，顯示手動按鈕讓使用者可以再按一次
                    showUI('manualUI'); 
                }
            } catch (err) {
                console.error(err);
                const code = err.code || "Unknown";
                const message = err.message || JSON.stringify(err);
                showUI('errorUI', `[${code}] ${message}`);
            }
        }

        // 主程式：初始化 -> 登入 -> 發送
        async function main() {
            try {
                await liff.init({ liffId: MY_LIFF_ID });
                if (!liff.isLoggedIn()) {
                    liff.login();
                } else {
                    sendAhongCard();
                }
            } catch (err) {
                showUI('errorUI', "LIFF Init Error: " + err.message);
            }
        }
        window.onload = main;
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
</body>
</html>